<html>
    <head>

    </head>
    <body>
        <div class="panel">
            <div class="panel_buttons"></div>
            <div class="panel_commands">
                <ul>                                  
                </ul>                

            </div>
        </div>
        <script>
            var actions = [
                {
                    name: 'lamp',
                    duration: 1000
                },
                {
                    name: 'object 2',
                    duration: 30000
                },
                {
                    name: 'object 3',
                    duration: 1000
                },
                {
                    name: 'object 4',
                    duration: 1000
                }
            ]

            let commands = [];
            let active_command = 0;

            var panel = document.querySelector('.panel_buttons');
            for (var i = 0; i < actions.length; i++) {
                var button = document.createElement('button');
                button.innerText = actions[i].name;
                button.setAttribute('data-action-name', actions[i].name);
                button.setAttribute('data-action-duration', actions[i].duration);
                panel.appendChild(button);
            }
            var buttons = document.querySelectorAll('button');
            var command_elem = document.querySelector('.panel_commands ul');
            buttons.forEach(function(button){
                button.addEventListener('click', function(){
                    const name = button.getAttribute('data-action-name');
                    commands.push(name);
                    updateCommands({ 
                        name,
                        duration: button.getAttribute('data-action-duration')
                    });                    
                })
            })

            const updateCommands = ({ name, duration}) => {                
                
                var li = document.createElement('li');
                var li_progress = document.createElement('span');                
                li_progress.classList.add('progress');                
                li.innerText = name;
                command_elem.appendChild(li);
                li.appendChild(li_progress);
            }

            let active = true;
            let state_duration;


            requestAnimationFrame(draw);

            function move_up(distance){
                
                const start = Date.now();
                const duration = 100; // 2 seconds
                //const distance = -100;
                const current_pos = command_elem.offsetTop;

                function move_list() {
                    
                    const elapsed = Date.now() - start;
                    const movement = (distance / duration * elapsed);
                    
                    let new_pos = current_pos + movement; // calculate new position
                                        
                    if (Math.abs(movement) >= Math.abs(distance)) {
                        newPos = current_pos + distance;
                        clearInterval(interval_id);
                        active = true;
                        command_elem.style.top = new_pos + 'px';                        
                        return;
                    }
                    command_elem.style.top = new_pos + 'px';
                    

                }

                const interval_id = setInterval(move_list, 10); // update position every 10 milliseconds

            }
            function draw(){                             
                const curr_commands = document.querySelectorAll('.panel_commands ul li');
                if (curr_commands){
                    const active_command_elem = curr_commands[active_command];
                    if (active_command_elem){
                        //console.log(active_command_elem);
                        const progress = active_command_elem.querySelector('.progress');
                        if (progress){
                            const duration = active_command_elem.getAttribute('data-action-duration');
                            const progress_width = progress.style.width;
                            if (progress_width){

                                const progress_width_int = parseInt(progress_width);
                                if (progress_width_int < 100){
                                    progress.style.width = progress_width_int + 1 + '%';
                                } else {
                                    // get height of div
                                    
                                    const elem = active_command_elem;
                                    const total_height = elem.offsetHeight;
                                    active = false;
                                    move_up(- 1 * total_height);
                                    active_command++;
                                }
                            } else {
                                progress.style.width = '1%';
                            }
                        }
                    }
                    if (active){                        
                        if (active_command >= commands.length){
                            active_command = 0;
                            commands = [];
                            command_elem.innerHTML = '';
                            command_elem.style.top = 0;
                        }
                    }                    
                }  
            
                          
                requestAnimationFrame(draw);
            }

        </script>
        <style>
            *{
                box-sizing: border-box;
            }
            body{
                margin: 0;
            }
            .panel{
                display: flex;
                width: 100%;
                height: 100vh;
            }
            .panel_commands{
                width: 70vw;
                background-color: black;
                color: white;            
                font-size: 10vh;                                
            }
                .panel_commands ul{
                    margin: 0;
                    padding: 0;
                    position: relative;
                    list-style: none;
                }
                .panel_commands li{
                    margin: 0;
                    position: relative;
                    padding: 10px 20px;
                    border-bottom: 1px solid white;
                }
                .progress{
                    position: absolute;
                    background-color: green;
                    height: 100%;
                    left: 0;
                    top: 0;
                    mix-blend-mode: screen;
                }
            /* .panel{
                display: grid;

            } */
            .panel_buttons{
                width: 30vw;
                display: grid;                
            }
            button{
                font-size: 10vh;
            }
        </style>
    </body>
</html>